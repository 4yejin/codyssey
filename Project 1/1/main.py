# ë‹¨ê³„ 1(project) - ê³¼ì • 1(Project 1) - ë¬¸ì œ 1
# -> mission_computer_main.log ì´ìš©, log_analysis.md ìƒì„±

# ì¡°ê±´
# ë¡œê·¸ ë¶„ì„ì„ ìœ„í•´ Pythonìœ¼ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ê°œë°œí•´ì•¼ í•œë‹¤. ì´ë¥¼ ìœ„í•´ì„œ ë¨¼ì € Pythonì„ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.
# ë¹ ë¥¸ ê°œë°œì„ ìœ„í•´ Python ê°œë°œ ë„êµ¬ë“¤ì„ ì•Œì•„ë³´ê³  ë¹„êµí•´ì„œ í•˜ë‚˜ì˜ ë„êµ¬ë¥¼ ì„ ì •í•´ì„œ ì„¤ì¹˜í•œë‹¤.
# ì„¤ì¹˜ê°€ ì˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸ í•˜ê¸° ìœ„í•´ì„œ â€˜Hello Marsâ€™ë¥¼ ì¶œë ¥í•´ ë³¸ë‹¤.
# ë³¸ê²©ì ìœ¼ë¡œ ë¡œê·¸ë¥¼ ë¶„ì„í•˜ê¸° ìœ„í•´ì„œ mission_computer_main.log íŒŒì¼ì„ ì—´ê³  ì „ì²´ ë‚´ìš©ì„ í™”ë©´ì— ì¶œë ¥í•´ ë³¸ë‹¤. ì´ë•Œ ì½”ë“œëŠ” main.py íŒŒì¼ë¡œ ì €ì¥í•œë‹¤.
# (ë¡œê·¸ ë°ì´í„°ëŠ” ë³„ë„ ì œê³µ)
# íŒŒì¼ì„ ì²˜ë¦¬ í•  ë•Œì— ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•œë‹¤.
# mission_computer_main.logì˜ ë‚´ìš©ì„ í†µí•´ì„œ ì‚¬ê³ ì˜ ì›ì¸ì„ ë¶„ì„í•˜ê³  ì •ë¦¬í•´ì„œ ë³´ê³ ì„œ(log_analysis.md)ë¥¼ Markdown í˜•íƒœë¡œ ë¥¼ ì‘ì„±í•´ ë†“ëŠ”ë‹¤.
	
# Python ë²„ì „ì€ 3.x ë²„ì „ìœ¼ë¡œ í•œë‹¤.
# Pythonì—ì„œ ê¸°ë³¸ ì œê³µë˜ëŠ” ëª…ë ¹ì–´ë§Œ ì‚¬ìš©í•´ì•¼ í•˜ë©° ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•´ì„œëŠ” ì•ˆëœë‹¤.
# Pythonì˜ coding style guideë¥¼ í™•ì¸í•˜ê³  ê°€ì´ë“œë¥¼ ì¤€ìˆ˜í•´ì„œ ì½”ë”©í•œë‹¤.
# (PEP 8 â€“ íŒŒì´ì¬ ì½”ë“œ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ | peps.python.org)
# ë¬¸ìì—´ì„ í‘œí˜„ í•  ë•Œì—ëŠ” â€˜ â€™ì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. ë‹¤ë§Œ ë¬¸ìì—´ ë‚´ì—ì„œ â€˜ì„ ì‚¬ìš©í•  ê²½ìš°ì™€ ê°™ì´ ë¶€ë“ì´í•œ ê²½ìš°ì—ëŠ” â€œ â€œë¥¼ ì‚¬ìš©í•œë‹¤.
# foo = (0,) ì™€ ê°™ì´ ëŒ€ì…ë¬¸ì˜ = ì• ë’¤ë¡œëŠ” ê³µë°±ì„ ì¤€ë‹¤.
# ë“¤ì—¬ ì“°ê¸°ëŠ” ê³µë°±ì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

# ì œì•½ì‚¬í•­
# ë³´ê³ ì„œëŠ” UTF8 í˜•íƒœì˜ encodingì„ ì‚¬ìš©í•´ì„œ ì €ì¥í•œë‹¤.
# ìˆ˜í–‰ ê³¼ì œì— ì§€ì‹œëœ íŒŒì¼ ì´ë¦„ì„ ì¤€ìˆ˜í•œë‹¤.

# ë³´ë„ˆìŠ¤ ê³¼ì œ
# ì¶œë ¥ ê²°ê³¼ë¥¼ ì‹œê°„ì˜ ì—­ìˆœìœ¼ë¡œ ì •ë ¬í•´ì„œ ì¶œë ¥í•œë‹¤.
# ì¶œë ¥ ê²°ê³¼ ì¤‘ ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ë§Œ ë”°ë¡œ íŒŒì¼ë¡œ ì €ì¥í•œë‹¤.

#--------------------------------------------------------------------------

import os # íŒŒì¼ ê²½ë¡œ í™•ì¸
from collections import Counter # ì´ë²¤íŠ¸ íšŸìˆ˜ ê³„ì‚°
import datetime # ì‹œê°„ ì •ë³´ ì–»ê¸° ìœ„í•¨
# ì–´ë””ì— ì ìš©ë˜ëŠ”ì§€ ê¶ê¸ˆí•˜ë©´ ì£¼ì„ì²˜ë¦¬ í•´ë³´ê¸°

print("Hello Mars")

# log íŒŒì¼ ê²½ë¡œ ì§€ì •
log_file_path = "./Project 1/mission_computer_main.log"

# ë¡œê·¸ íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
if not os.path.exists(log_file_path): # íŒŒì¼ ì¡´ì¬í•˜ì§€ ì•Šì„ ë•Œ true
    print(f"âŒ ë¡œê·¸ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: {log_file_path}")
    exit(1) # 0 : ì •ìƒ ì¢…ë£Œ, 1 : ì—ëŸ¬ë¡œ ì¸í•œ ë¹„ì •ìƒ ì¢…ë£Œ

# ë¡œê·¸ íŒŒì¼ ì—´ê¸° ë° ì¶œë ¥
try: # ì˜ˆì™¸ ë°œìƒ ì½”ë“œ ì‹¤í–‰
    with open(log_file_path, "r", encoding="utf-8") as file: # withêµ¬ë¬¸ì€ ìë™ìœ¼ë¡œ ë‹«í˜
        for line in file: # í•œ ì¤„ ì”© ì½ê¸°
            print(line.strip()) # ì–‘ìª½ ê³µë°±(íŠ¹íˆ ì¤„ ë°”ê¿ˆ ë¬¸ì \n) ì œê±° í›„ ì¶œë ¥
except Exception as e: # ì˜¤ë¥˜ ë°œìƒ ì‹œ í•´ë‹¹ ë¸”ë¡ ì‹¤í–‰ _ ì˜ˆì™¸ì²˜ë¦¬
    print(f"âŒ ë¡œê·¸ íŒŒì¼ ì—´ê¸° ì‹¤íŒ¨: {e}") # eì— ì‹¤ì œ ì˜¤ë¥˜ ë©”ì„¸ì§€ ìë™ìœ¼ë¡œ ì‚½ì…
    exit(1)

# ì´ìƒ ë¡œê·¸ íƒì§€
print("\nâ— ì´ìƒ ë¡œê·¸ íƒì§€:")
keywords = ["unstable", "explosion", "error", "fail"]

try:
    with open(log_file_path, "r", encoding="utf-8") as file:
        next(file)  # ì²« ì¤„ í—¤ë” ìƒëµ
        for line in file:
            if any(k in line.lower() for k in keywords): 
                # keywords ì¤‘ í•˜ë‚˜ë¼ë„ í¬í•¨ë˜ì–´ìˆìœ¼ë©´ ì¡°ê±´ ë§Œì¡±
                #line.lower() : ì†Œë¬¸ìë¡œ ì „ë¶€ êµì²´
                print("âš ï¸", line.strip())
except Exception as e:
    print(f"âŒ ë¡œê·¸ íƒì§€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
    exit(1)

# ë¡œê·¸ ë¶„ì„
event_counter = Counter() # í•­ëª©ë³„ ê°œìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ì„¸ì–´ì¤Œ
anomalies = [] # ì´ìƒ ë¡œê·¸ë¥¼ ë‹´ì•„ì¤„ ë¦¬ìŠ¤íŠ¸, (ì‹œê°„, ë©”ì„¸ì§€ í˜•íƒœë¡œ ì¶”ê°€)

try:
    with open(log_file_path, "r", encoding="utf-8") as file:
        lines = [line.strip() for line in file if line.strip()]

    for line in lines[1:]:  # ì²« ì¤„ì€ header ìƒëµ, ë‘ ë²ˆì§¸ ì¤„ë¶€í„° ë°˜ë³µ
        parts = line.split(",", 2) # ê° ì¤„ì„ ì‰¼í‘œ ê¸°ì¤€ìœ¼ë¡œ 3ê°œë¡œ ë‚˜ëˆ”
        if len(parts) == 3: # ì˜ ë¶„ë¦¬ëœê±´ì§€ í™•ì¸
            timestamp, event, message = parts # ë³€ìˆ˜í• ë‹¹
            event_counter[event.strip()] += 1 # í•´ë‹¹ ì´ë²¤íŠ¸ ì´ë¦„ ì¶œí˜„ íšŸìˆ˜ 1 ì¦ê°€
            if any(k in message.lower() for k in keywords):
                anomalies.append((timestamp.strip(), message.strip()))
                # ë©”ì„¸ì§€ì— unstable, explosion, error, fail ì¤‘ í•˜ë‚œë¼ë„ ìˆë‹¤ë©´
                # anomalies ë¦¬ìŠ¤íŠ¸ì— (timestamp, message) íŠœí”Œ ì €ì¥
        else:
            print(f"âš ï¸ ë¡œê·¸ í˜•ì‹ ì´ìƒ ë¬´ì‹œë¨: {line}")
            # ë§Œì•½ 3ê°œì˜ í•­ëª©ì´ ì•„ë‹ˆë©´ ê²½ê³  ë©”ì„¸ì§€ ì¶œë ¥ í›„ ê±´ë„ˆëœ€

except Exception as e:
    print(f"âŒ ë¡œê·¸ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
    exit(1) # ì „ì²´ ë¶„ì„ ì¤‘ ë¬¸ì œ ë°œìƒì‹œ ì—ëŸ¬ë©”ì„¸ì§€ ì¶œë ¥ í›„ í”„ë¡œê·¸ë¨ ì¢…ë£Œ

# Markdown ì €ì¥ ê²½ë¡œ
output_path = "./Project 1/log_analysis.md"

# Markdown ì €ì¥
try:
    with open(output_path, "w", encoding="utf-8") as f:
        f.write("# ğŸ“„ ë¡œê·¸ ë¶„ì„ ë³´ê³ ì„œ\n\n")
        f.write(f"**íŒŒì¼ ê²½ë¡œ**: `{log_file_path}`\n")
        f.write(f"**ìƒì„± ì‹œê°**: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")

        f.write("## ğŸ“Š ì´ë²¤íŠ¸ í†µê³„\n\n")
        f.write("| ì´ë²¤íŠ¸ | íšŸìˆ˜ |\n")
        f.write("|---------|------|\n")
        for evt, count in event_counter.items():
            f.write(f"| {evt} | {count} |\n")

        f.write("\n---\n\n")
        f.write("## â— ì´ìƒ ë¡œê·¸ ë©”ì‹œì§€\n\n")
        if anomalies:
            for ts, msg in anomalies:
                f.write(f"- `{ts}` â†’ âš ï¸ {msg}\n")
        else:
            f.write("_ì´ìƒ ë¡œê·¸ ì—†ìŒ_\n")

        f.write("\n---\n\n")
        f.write("## ğŸ“Œ í•´ì„ ë° ì‚¬ê³  ì›ì¸ ì •ë¦¬ (ìˆ˜ë™ ì…ë ¥)\n\n")
        f.write("> âš ï¸ ì´ ì„¹ì…˜ì€ ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.\n")
        f.write("> ì˜ˆ: 'ì‚°ì†Œ íƒ±í¬ ì´ìƒ ê°ì§€ í›„ í­ë°œì´ ë°œìƒí•¨. ì°©ë¥™ ì´í›„ ì‹œìŠ¤í…œ ë¬¸ì œë¡œ ì¶”ì •ë¨.'\n")

    if os.path.exists(output_path):
        print("âœ… ë³´ê³ ì„œ ì €ì¥ ì„±ê³µ:", os.path.abspath(output_path))
    else:
        print("âŒ ë³´ê³ ì„œ íŒŒì¼ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")

except Exception as e:
    print(f"âŒ Markdown ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
    exit(1)
